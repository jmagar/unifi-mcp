services:
  unifi-mcp:
    build: .
    container_name: unifi-mcp
    restart: unless-stopped
    ports:
      - "${UNIFI_LOCAL_MCP_PORT:-8001}:${UNIFI_LOCAL_MCP_PORT:-8001}"
    environment:
      # UniFi Controller Configuration
      - UNIFI_CONTROLLER_URL=${UNIFI_CONTROLLER_URL:-https://192.168.1.1:443}
      - UNIFI_USERNAME=${UNIFI_USERNAME:-admin}
      - UNIFI_PASSWORD=${UNIFI_PASSWORD}
      - UNIFI_IS_UDM_PRO=${UNIFI_IS_UDM_PRO:-true}
      - UNIFI_VERIFY_SSL=${UNIFI_VERIFY_SSL:-false}
      
      # Server Configuration
      - UNIFI_LOCAL_MCP_HOST=${UNIFI_LOCAL_MCP_HOST:-0.0.0.0}
      - UNIFI_LOCAL_MCP_PORT=${UNIFI_LOCAL_MCP_PORT:-8001}
      - UNIFI_LOCAL_MCP_LOG_LEVEL=${UNIFI_LOCAL_MCP_LOG_LEVEL:-INFO}
      - UNIFI_LOCAL_MCP_LOG_FILE=${UNIFI_LOCAL_MCP_LOG_FILE:-/app/logs/unifi-mcp.log}
      
      # Google OAuth Authentication (FastMCP)
      - FASTMCP_SERVER_AUTH=${FASTMCP_SERVER_AUTH}
      - FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_ID=${FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_ID}
      - FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_SECRET=${FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_SECRET}
      - FASTMCP_SERVER_AUTH_GOOGLE_BASE_URL=${FASTMCP_SERVER_AUTH_GOOGLE_BASE_URL}
      - FASTMCP_SERVER_AUTH_GOOGLE_REQUIRED_SCOPES=${FASTMCP_SERVER_AUTH_GOOGLE_REQUIRED_SCOPES}
      - FASTMCP_SERVER_AUTH_GOOGLE_REDIRECT_PATH=${FASTMCP_SERVER_AUTH_GOOGLE_REDIRECT_PATH:-/auth/callback}
      - FASTMCP_SERVER_AUTH_GOOGLE_TIMEOUT_SECONDS=${FASTMCP_SERVER_AUTH_GOOGLE_TIMEOUT_SECONDS:-10}
      
      # Logging and Process Management
      - MCP_LOG_FILE=${MCP_LOG_FILE:-/app/logs/unifi-mcp.log}
      - MCP_PID_FILE=${MCP_PID_FILE:-/app/logs/unifi-mcp.pid}
    
    # Volume mounts
    volumes:
      - unifi-mcp-logs:/app/logs
    
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${UNIFI_LOCAL_MCP_PORT:-8001}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - unifi-mcp-network

volumes:
  unifi-mcp-logs:
    driver: local

networks:
  unifi-mcp-network:
    driver: bridge
